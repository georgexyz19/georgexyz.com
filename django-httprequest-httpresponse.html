<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/theme/css/bs4min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/theme/images/favicon.ico" >
    <link rel="icon" type="image/x-icon" href="/theme/images/favicon.ico" >
<link rel="stylesheet" href="https://www.georgexyz.com/theme/css/friendly.css">
<link rel="stylesheet" href="https://www.georgexyz.com/theme/css/custom.css">
<meta name="author" content="George Zhang" />
<meta name="keywords" content="django" />
<meta name="description" content="Django view “is simply a Python function that takes a web request and returns a response.” A typical view function loads template, retrieves some data from database, and returns a …" />
    <title>Django HttpRequest and HttpResponse - George Zhang</title>
  </head>
  <body>
    <!-- navbar -->
    <nav class="navbar navbar-expand-md navbar-light" style="background-color: #e3f2fd;">
      <div class="container">
        <a class="navbar-brand" href="/">George Zhang</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link " 
                href="/articlelist.html">Articles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link pr-3 " 
                href="/tags.html">Tags</a>
            </li>
            <li class="nav-item">
              <a class="nav-link pr-3 "
                 href="/pages/inkscape-tutorial.html">Inkscape Tutorial</a>
            </li>
            <li class="nav-item">
                <a class="nav-link "
                   href="/pages/projects.html">Projects</a>
              </li>
          </ul>

          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link " 
                 href="/pages/about.html">About</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

   

<div class="container">

  <div class="row">
    <div class="col-lg-8 mx-auto">

      <h2>Django HttpRequest and HttpResponse</h2>

      <div class="text-muted mb-2">
        <span>Posted on </span>
        <time datetime="2019-07-11 23:45:00-04:00">
          Thursday, 07/11/2019 23:45
        </time>

        <span>with tags: </span>
        <a href="https://www.georgexyz.com/tag/django.html">django</a>
      </div>

      <p>Django view &#8220;is simply a Python function that takes a web request and 
returns a response.&#8221; A typical view function loads template, retrieves 
some data from database, and returns a response. Django 1.3 starts supporting 
class-based views, which makes writing views easier. The drawback is that 
the code is not as straightforward to understand as function-based view. </p>
<p>Here is a typical Django view function from official Django tutorial. </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">latest</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-pub_date&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;polls/index.html&#39;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span> <span class="n">latest</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</code></pre></div>


<p>The request object passed to the view function is a WSGIRequest object, and 
WSGIRequest is a subclass of HttpRequest.  When web browser sends an http/https
request to the web server, Django web framework receives the infomation in 
the form of an environ object, and creates the request object.  Yes, Django 
creates this object and passes it to the view function.  This is a 
typical example of <em>inversion of control</em>. A web app developer does not have
control over the flow of a program when using a web framework. </p>
<p>The HttpRequest and HttpResponse classes are defined in the request.py and 
response.py files in http directory. The response.py file also defines 
several other classes such as Http404 and HttpResponseRedirect. </p>
<p>The Django official documentation has 
<a href="https://docs.djangoproject.com/en/2.2/ref/request-response/">a reference page</a> 
for HttpRequest and HttpResponse. It is probably to easier to read the source 
code directly. Here is a list of files in the http directory.</p>
<div class="highlight"><pre><span></span><code>george@STK2M3:~/Desktop/django-2.2.2/django$ wc -l http/*.py
   26 http/cookie.py
   21 http/__init__.py
  688 http/multipartparser.py
  602 http/request.py
  559 http/response.py
 1896 total
</code></pre></div>


<p>How do I find this information? The grep command below shows that HttpRequest 
only appears a few places in Django source code. The wsgi.py file defines the 
WSGIRequst class as a subclass of HttpRequest. </p>
<div class="highlight"><pre><span></span><code>george@STK2M3:~/Desktop/django-2.2.2/django$ grep -r &quot;HttpRequest&quot; ./
./template/context.py:    Create a suitable Context from a plain dict ...
./core/handlers/base.py:        &quot;&quot;&quot;Return an HttpResponse object for  ...
./core/handlers/wsgi.py:from django.http import HttpRequest, QueryDict, parse_cookie
./core/handlers/wsgi.py:class WSGIRequest(HttpRequest):    ++++++ Notice ++++
./core/files/uploadhandler.py:        &gt;&gt;&gt; from django.http import HttpRequest
./core/files/uploadhandler.py:        &gt;&gt;&gt; request = HttpRequest()
./views/decorators/debug.py:from django.http import HttpRequest
......
</code></pre></div>


<p>We can then try to find where the WSGIRequest object is defined and passed along 
to other functions as an argument. </p>
<div class="highlight"><pre><span></span><code>george@STK2M3:~/Desktop/django-2.2.2/django$ grep -rn &quot;WSGIRequest&quot; ./core
./core/management/commands/runserver.py:57:   # way to reach WSGIRequestHandler....
./core/handlers/wsgi.py:66:class WSGIRequest(HttpRequest):
./core/handlers/wsgi.py:131:    request_class = WSGIRequest
...
</code></pre></div>


<p>In the file wsgi.py line 131, it assigns WSGIRequest class to <code>request_class</code>. 
Let&#8217;s try to find where <code>request_class</code> is instantiated. </p>
<div class="highlight"><pre><span></span><code>george@STK2M3:~/Desktop/django-2.2.2/django$ grep -rn &quot;request_class&quot; ./core
./core/handlers/wsgi.py:131:    request_class = WSGIRequest
./core/handlers/wsgi.py:140:        request = self.request_class(environ)
</code></pre></div>


<p>Grep command can also see the lines before and after the target line.  The command 
below shows the context code. </p>
<div class="highlight"><pre><span></span><code>george@STK2M3:~/Desktop/django-2.2.2/django$ grep -rn -C 5 &quot;request_class&quot; ./core
....
./core/handlers/wsgi.py-130-class WSGIHandler(base.BaseHandler):
./core/handlers/wsgi.py:131:    request_class = WSGIRequest
./core/handlers/wsgi.py-132-
./core/handlers/wsgi.py-133-    def __init__(self, *args, **kwargs):
./core/handlers/wsgi.py-134-        super().__init__(*args, **kwargs)
./core/handlers/wsgi.py-135-        self.load_middleware()
./core/handlers/wsgi.py-136-
./core/handlers/wsgi.py-137-    def __call__(self, environ, start_response):
./core/handlers/wsgi.py-138-        set_script_prefix(get_script_name(environ))
./core/handlers/wsgi.py-139-        signals.request_started.send(sender=self.__class__, environ=environ)
./core/handlers/wsgi.py:140:        request = self.request_class(environ)
./core/handlers/wsgi.py-141-        response = self.get_response(request)
./core/handlers/wsgi.py-142-
./core/handlers/wsgi.py-143-        response._handler_class = self.__class__
./core/handlers/wsgi.py-144-
./core/handlers/wsgi.py-145-        status = &#39;%d %s&#39; % (response.status_code, response.reason_phrase)
</code></pre></div>


<p>The wsgi.py line 141 <code>response = self.get_response(request)</code> is where 
the request is passed to the view function. It is also where the response created 
in the view function passed back to the Django. 
<a href="https://www.georgexyz.com/django-WSGI.html">The <span class="caps">WSGI</span> discussion</a> 
clearly shows that the <code>environ</code> argument is the one passed on by the web 
server. </p>
<p><span class="dquo">&#8220;</span>The <code>get_response</code> method is where nearly all of the activity happens.&#8221; James 
Bennett&#8217;s article 
<a href="https://www.b-list.org/weblog/2006/jun/13/how-django-processes-request/">How Django processes a request</a> 
has a very detailed discussion on the topic. </p>
<p>If you want to find out what information is contained in the reqeust object, the 
view function below displays the contents. </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">display_meta</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c1"># from django book</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&lt;table&gt;</span><span class="si">%s</span><span class="s1">&lt;/table&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">html</span><span class="p">)</span> <span class="p">)</span>  <span class="c1"># added by me</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;Number of items in META : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.path : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.get_host() : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_host</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.get_full_path() : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.is_secure() : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">is_secure</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.method : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.encoding : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;request.content_type : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">content_type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> 
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>  <span class="c1"># for debug only</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</code></pre></div>


<p>Here is the partial output from the <code>display_meta</code> function:</p>
<div class="highlight"><pre><span></span><code>......
XDG_SESSION_DESKTOP cinnamon
XDG_SESSION_ID  c2
XDG_SESSION_PATH    /org/freedesktop/DisplayManager/Session0
XDG_SESSION_TYPE    x11
XDG_VTNR    7
_   /home/george/.venv/django/bin/python
wsgi.errors &lt;_io.TextIOWrapper name=&#39;&#39; mode=&#39;w&#39; encoding=&#39;UTF-8&#39;&gt;
wsgi.file_wrapper   
wsgi.input  
wsgi.multiprocess   False
wsgi.multithread    True
wsgi.run_once   False
wsgi.url_scheme http
wsgi.version    (1, 0)

Number of items in META : 85
request.path : /info/
request.get_host() : 127.0.0.1:8000
request.get_full_path() : /info/
request.is_secure() : False
request.method : GET
request.encoding : None
request.content_type : text/plain
</code></pre></div>



    </div>
  </div>

</div>

   
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  </body>
</html>