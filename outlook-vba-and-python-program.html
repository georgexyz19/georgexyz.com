<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/theme/css/bs4min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/theme/images/favicon.ico" >
    <link rel="icon" type="image/x-icon" href="/theme/images/favicon.ico" >
<link rel="stylesheet" href="https://www.georgexyz.com/theme/css/friendly.css">
<link rel="stylesheet" href="https://www.georgexyz.com/theme/css/custom.css">
<meta name="author" content="George Zhang" />
<meta name="keywords" content="ai,python" />
<meta name="description" content="I am trying to automate some of my Outlook tasks and have found something interesting. Some of the emails I receive from a system include a line with latitude and â€¦" />
    <title>Outlook VBA and Python Program - George Zhang</title>
  </head>
  <body>
    <!-- navbar -->
    <nav class="navbar navbar-expand-md navbar-light" style="background-color: #e3f2fd;">
      <div class="container">
        <a class="navbar-brand" href="/">George Zhang</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link " 
                href="/articlelist.html">Articles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link pr-3 " 
                href="/tags.html">Tags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link "
                   href="/pages/projects.html">Projects</a>
              </li>
          </ul>

          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link " 
                 href="/pages/about.html">About</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

   

<div class="container">

  <div class="row">
    <div class="col-lg-8 mx-auto">

      <h2>Outlook <span class="caps">VBA</span> and Python Program</h2>

      <div class="text-muted mb-1">
        <span>Originally Posted on </span>
        <time datetime="2025-09-20 00:19:00-04:00">
          Saturday, 09/20/2025 00:19
        </time>

        <span>with tags: </span>
        <a href="https://www.georgexyz.com/tag/ai.html">ai</a>
/        <a href="https://www.georgexyz.com/tag/python.html">python</a>
      </div>

      <div class="text-muted mb-4">
        <span>Last Update on </span>
        <time datetime="2025-09-20 00:19:00-04:00">
          Saturday, 09/20/2025 00:19
        </time>
      </div>

      <p>I am trying to automate some of my Outlook tasks and have found something interesting. 
Some of the emails I receive from a system include a line with latitude and longitude 
coordinates, like this:</p>
<div class="highlight"><pre><span></span><code>Lat/Lon: 37.83635720,-76.17577260
</code></pre></div>

<p>I want to write a Python program to read the coordinate and determine whether it falls 
within a specific county. If the coordinate is inside the county boundary, the 
program will perform certain actions.</p>
<p>My first thought was to try accessing Outlook emails using Python. Python has a win32com 
package that can be used to interact with Outlook. However, I discovered that my Outlook 
has a security setting that does not allow third-party programs to read email messages. 
As a result, the following piece of code does not work:</p>
<div class="highlight"><pre><span></span><code><span class="n">outlook</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="s2">&quot;Outlook.Application&quot;</span><span class="p">)</span>
<span class="n">explorer</span> <span class="o">=</span> <span class="n">outlook</span><span class="o">.</span><span class="n">ActiveExplorer</span><span class="p">()</span>

<span class="n">selection</span> <span class="o">=</span> <span class="n">explorer</span><span class="o">.</span><span class="n">Selection</span> <span class="c1"># selected msgs</span>
<span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">Count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No item selected.&quot;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">item</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">Item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">Body</span> <span class="c1"># no access to body</span>
</code></pre></div>

<p>Interestingly, if the email message has a <span class="caps">PDF</span> attachment, the Python program can save it 
to disk and read from the <span class="caps">PDF</span>. The code below actually works fine.</p>
<div class="highlight"><pre><span></span><code><span class="n">outlook</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="s2">&quot;Outlook.Application&quot;</span><span class="p">)</span>
<span class="n">namespace</span> <span class="o">=</span> <span class="n">outlook</span><span class="o">.</span><span class="n">GetNamespace</span><span class="p">(</span><span class="s2">&quot;MAPI&quot;</span><span class="p">)</span>
<span class="n">selected_items</span> <span class="o">=</span> <span class="n">outlook</span><span class="o">.</span><span class="n">ActiveExplorer</span><span class="p">()</span><span class="o">.</span><span class="n">Selection</span>

<span class="k">for</span> <span class="n">mail</span> <span class="ow">in</span> <span class="n">selected_items</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="n">mail</span><span class="o">.</span><span class="n">Attachments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">attachment</span><span class="o">.</span><span class="n">FileName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">):</span>
            <span class="c1"># Generate a unique temp file path</span>
            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
            <span class="n">unique_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">unique_filename</span><span class="p">)</span>

            <span class="c1"># Save the attachment</span>
            <span class="n">attachment</span><span class="o">.</span><span class="n">SaveAsFile</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved: </span><span class="si">{</span><span class="n">temp_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Extract text from the PDF</span>
            <span class="n">extracted_text</span> <span class="o">=</span> <span class="n">extract_text_from_pdf</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
</code></pre></div>

<p>The next step is to write an Outlook <span class="caps">VBA</span> program that saves the email as a .msg file. 
The <span class="caps">VBA</span> program can then call a Python script to process the file. The Python script 
can write the result to a second file, which the <span class="caps">VBA</span> program can read to retrieve the 
result. The steps may sound complicated, but the code itself is actually quite straightforward.</p>
<p>Below are the <span class="caps">VBA</span> and Python code files:</p>
<p><a href="/files/InCounty_Check.vba.txt"><span class="caps">VBA</span> program in txt form</a></p>
<p><a href="/files/extract_latlon.py.txt">Python program in txt form</a></p>
<p>Another interesting point is that we can use the pdfplumber Python package to read <span class="caps">PDF</span> 
files and extract text from them. As mentioned earlier, win32com can save email attachments. 
So, if you only need to extract information from a <span class="caps">PDF</span> email attachment, you can write a 
pure Python program to handle it. If the Python program includes a <span class="caps">GUI</span> built with tkinter, 
you can convert the script into a Windows executable file using PyInstaller. The command is:</p>
<div class="highlight"><pre><span></span><code>pyinstaller --onefile --windowed textbox_copy.py
</code></pre></div>

<p>Note that the generated executable can be quite large. In my case, the .exe file is 
around 65 <span class="caps">MB</span>, even though the original Python script is relatively small.</p>



    </div>
  </div>

</div>

   
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  </body>
</html>