<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/theme/css/bs4min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/theme/images/favicon.ico" >
    <link rel="icon" type="image/x-icon" href="/theme/images/favicon.ico" >
<link rel="stylesheet" href="https://www.georgexyz.com/theme/css/friendly.css">
<link rel="stylesheet" href="https://www.georgexyz.com/theme/css/custom.css">
<meta name="author" content="George Zhang" />
<meta name="keywords" content="docker,flask" />
<meta name="description" content="Miguel Grinberg’s Flask Web Development book Chapter 5 shows how to run Flask with SqlAlchemy and a SQLite database. Because SQLite is included in Python, the settings are simple …" />
    <title>Run MySql In A Docker Container With Flask - George Zhang</title>
  </head>
  <body>
    <!-- navbar -->
    <nav class="navbar navbar-expand-md navbar-light" style="background-color: #e3f2fd;">
      <div class="container">
        <a class="navbar-brand" href="/">George Zhang</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link " 
                href="/articlelist.html">Articles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link pr-3 " 
                href="/tags.html">Tags</a>
            </li>
            <li class="nav-item">
                <a class="nav-link "
                   href="/pages/projects.html">Projects</a>
              </li>
          </ul>

          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link " 
                 href="/pages/about.html">About</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

   

<div class="container">

  <div class="row">
    <div class="col-lg-8 mx-auto">

      <h2>Run MySql In A Docker Container With Flask</h2>

      <div class="text-muted mb-2">
        <span>Posted on </span>
        <time datetime="2021-04-28 13:25:00-04:00">
          Wednesday, 04/28/2021 13:25
        </time>

        <span>with tags: </span>
        <a href="https://www.georgexyz.com/tag/docker.html">docker</a>
/        <a href="https://www.georgexyz.com/tag/flask.html">flask</a>
      </div>

      <p>Miguel Grinberg&#8217;s <em>Flask Web Development</em> book Chapter 5 shows how to run Flask with 
SqlAlchemy and a SQLite database. Because SQLite is included in Python, the settings 
are simple and easy. This post records the steps on how to run a MySQL database in a docker 
container with Flask (under a Linux Mint <span class="caps">OS</span> or Ubuntu). </p>
<h3>Install Docker</h3>
<p>The first step is to install docker and pull the MySQL container image. This 
<a href="https://docker-curriculum.com/">Docker Curriculum</a> website has a nice Docker 
tutorial. </p>
<div class="highlight"><pre><span></span><code>curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh 
sudo usermod -aG docker george  # restart after this step

# those steps installs docker-compose, optional
sudo curl -L &quot;https://github.com/docker/compose/releases/download/\
              1.29.1/docker-compose-$(uname -s)-$(uname -m)&quot;\ 
              -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose 
docker-compose

docker pull mysql:latest
docker images
</code></pre></div>

<h3>Run Container</h3>
<p>How to start running the MySQL container is a little tricky. After some Google 
searching, I found that this 
<a href="https://medium.com/swlh/how-to-connect-to-mysql-docker-from-python-application-on-macos-mojave-32c7834e5afa">medium article</a> 
has nice practical examples. I simply create a bash script <code>start_mysql.sh</code> and 
bash command <code>source start_mysql.sh</code> will start the container. The script includes 
a <code>-v</code> volume option which maps a directory on a host to the mysql data directory 
in the container. So the database data files are saved on the host computer. </p>
<div class="highlight"><pre><span></span><code># start_mysql.sh file
#!/bin/bash
docker run --name=test-mysql \
    --env=&quot;MYSQL_ROOT_PASSWORD=pw&quot; \
    -p 3306:3306 \
    -v /home/george/Code/docker/test-mysql/data:/var/lib/mysql \
    -d  \
    mysql:latest
</code></pre></div>

<p>A second bash script <code>mysql-terminal.sh</code> starts a terminal session which runs 
<code>mysql</code> client inside the container. It will enter the <code>mysql</code> as a <code>root</code> user. </p>
<div class="highlight"><pre><span></span><code># mysql-terminal.sh file
#!/bin/bash
docker exec -it test-mysql mysql -uroot -ppw
</code></pre></div>

<p>You can create a new db and a user once you are in the <code>mysql</code> client with 
those commands. </p>
<div class="highlight"><pre><span></span><code>CREATE DATABASE test_db;
USE test_db;
CREATE USER &#39;newuser&#39;@&#39;%&#39; IDENTIFIED BY &#39;pw&#39;;
GRANT ALL PRIVILEGES ON test_db.* to &#39;newuser&#39;@&#39;%&#39;;
</code></pre></div>

<h3>Connect Flask App</h3>
<p>Once you have the docker container running, you can connect a Flask app to it.
The first step is to install flask-sqlalchemy, pymysql, and cryptography packages 
in virtual environment. </p>
<div class="highlight"><pre><span></span><code>. venv/bin/activate
pip install flask-sqlalchemy pymysql cryptography
</code></pre></div>

<p>Note the pymysql and cryptography packages are required. I cannot make it working 
without those packages. </p>
<p>In the flask app python file, have those db settings. </p>
<div class="highlight"><pre><span></span><code>app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] = \
    &#39;mysql+pymysql://newuser:pw@localhost:3306/test_db&#39;
app.config[&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;] = False
</code></pre></div>

<p>Then you can run the <code>flask shell</code> and run those commands to test the db connections. </p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt;from hello import db
&gt;&gt;&gt;db.create_all()
&gt;&gt;&gt;db.metadata.tables.keys()  # show table names
</code></pre></div>



    </div>
  </div>

</div>

   
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  </body>
</html>